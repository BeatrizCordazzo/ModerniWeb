<app-nav></app-nav>

<main class="services-page">
  <section class="services-hero">
    <div class="inner">
      <h1 class="title">Choose a service</h1>
      <p class="lead">Select one area to start (kitchen, bathroom, living room, bedroom or other).</p>
      @if (isAdmin) {
        <div class="admin-toolbar">
          <button class="admin-add-btn" (click)="toggleAddForm()">
            {{ showAddForm ? 'Close' : 'Add' }} new
          </button>
        </div>
      }
    </div>
  </section>

  @if (isAdmin && showAddForm) {
    <section class="admin-add-section" aria-live="polite">
      <div class="inner">
        <div class="admin-card">
          <header class="admin-card-header">
            <div>
              <p class="eyebrow">Furniture and Services Management</p>
              <h2>Create New Item</h2>
            </div>
            <button class="admin-close" type="button" (click)="toggleAddForm()" aria-label="Close form">
              &times;
            </button>
          </header>

          <form [formGroup]="addProductForm" (ngSubmit)="submitNewProduct()" class="admin-add-form">
            <div class="form-grid">
              <label class="form-field">
                <span>Name*</span>
                <input type="text" formControlName="name" placeholder="E.g. Modern Kitchen">
                @if (addProductForm.get('name')?.invalid && addProductForm.get('name')?.touched) {
                  <small class="error-text">Name is required.</small>
                }
              </label>

              <label class="form-field">
                <span>Category / Type*</span>
                <select formControlName="type">
                  @for (option of productTypeOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              </label>

              <label class="form-field">
                <span>Subcategory</span>
                @if (isCategoryLocked) {
                  <input type="text" [value]="addProductForm.get('categoryName')?.value" readonly>
                } @else {
                  <select formControlName="categoryName">
                    @for (category of individualCategoryOptions; track category) {
                      <option [value]="category">{{ category }}</option>
                    }
                  </select>
                }
              </label>

              <label class="form-field">
                <span>Base Price*</span>
                <input type="number" formControlName="price" placeholder="0.00" step="0.01" min="0">
                @if (addProductForm.get('price')?.invalid && addProductForm.get('price')?.touched) {
                  <small class="error-text">Enter a valid price.</small>
                }
              </label>

              <label class="form-field">
                <span>Old Price</span>
                <input type="number" formControlName="oldPrice" placeholder="0.00" step="0.01" min="0">
              </label>

              <label class="form-field">
                <span>Stock</span>
                <input type="number" formControlName="stock" min="0" placeholder="0">
              </label>
            </div>

            <div class="form-row checkbox-row">
              <label class="checkbox-field">
                <input type="checkbox" formControlName="inStock">
                <span>Available for immediate sale</span>
              </label>
            </div>

            <label class="form-field">
              <span>Description</span>
              <textarea formControlName="description" rows="3" placeholder="Describe materials, style, or what is included."></textarea>
            </label>

            <div class="form-grid">
              <label class="form-field">
                <span>Collection</span>
                <input type="text" formControlName="collection" placeholder="E.g. Nordic">
              </label>
              <label class="form-field">
                <span>Style</span>
                <input type="text" formControlName="style" placeholder="Contemporary, Rustic, etc.">
              </label>
              <label class="form-field">
                <span>Main Image (URL)</span>
                <input type="url" formControlName="image" placeholder="https://">
              </label>
            </div>

            <div class="form-grid three">
              <label class="form-field">
                <span>Width</span>
                <input type="text" formControlName="dimensionsWidth" placeholder="E.g. 3.5m">
              </label>
              <label class="form-field">
                <span>Height</span>
                <input type="text" formControlName="dimensionsHeight" placeholder="E.g. 2.4m">
              </label>
              <label class="form-field">
                <span>Depth</span>
                <input type="text" formControlName="dimensionsDepth" placeholder="E.g. 60cm">
              </label>
            </div>

            <label class="form-field">
              <span>Includes (one per line)</span>
              <textarea formControlName="includes" rows="2" placeholder="Kitchen island&#10;Quartz countertop&#10;LED lighting"></textarea>
            </label>

            <label class="form-field">
              <span>Colors (one per line, format: Name #HEX)</span>
              <textarea formControlName="colors" rows="2" placeholder="White #FFFFFF&#10;Black #000000"></textarea>
            </label>

            @if (saveError) {
              <p class="status-message error">{{ saveError }}</p>
            }
            @if (saveSuccess) {
              <p class="status-message success">{{ saveSuccess }}</p>
            }

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="toggleAddForm()">Cancel</button>
              <button type="submit" class="btn-primary" [disabled]="isSaving">
                {{ isSaving ? 'Savingâ€¦' : 'Save Product' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>
  }

  <section class="services-grid-section">
    <div class="inner">
      <div class="services-grid" role="list">
        <article class="service-card" role="listitem" tabindex="0" aria-label="Kitchen" routerLink="kitchen">
          <div class="media kitchen" aria-hidden="true"></div>
          <h3 class="service-name">Kitchen</h3>
        </article>

        <article class="service-card" role="listitem" tabindex="0" aria-label="Bathroom" routerLink="bathroom">
          <div class="media bathroom" aria-hidden="true"></div>
          <h3 class="service-name">Bathroom</h3>
        </article>

        <article class="service-card" role="listitem" tabindex="0" aria-label="Living room" routerLink="livingroom">
          <div class="media livingroom" aria-hidden="true"></div>
          <h3 class="service-name">Living room</h3>
        </article>

        <article class="service-card" role="listitem" tabindex="0" aria-label="Bedroom" routerLink="bedroom">
          <div class="media bedroom" aria-hidden="true"></div>
          <h3 class="service-name">Bedroom</h3>
        </article>

        <article class="service-card" role="listitem" tabindex="0" aria-label="Other" routerLink="others">
          <div class="media other" aria-hidden="true"></div>
          <h3 class="service-name">Other (single piece)</h3>
        </article>
      </div>

      <p class="note">Tip: Click on any service to view details.</p>
    </div>
  </section>

  <!-- Outlet para las rutas hijas -->
  <router-outlet></router-outlet>
</main>

<app-footer></app-footer>
