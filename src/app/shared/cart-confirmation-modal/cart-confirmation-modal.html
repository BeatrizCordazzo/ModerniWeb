@if (isOpen) {
  <div class="modal-backdrop" (click)="onBackdropClick($event)">
    @if (item) {
      <div class="modal-container">
        <div class="modal-header">
          <h2>Confirm Add to Cart</h2>
          <button class="close-btn" (click)="onCancel()" aria-label="Close modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="product-preview">
            <div class="product-image">
              <img [src]="(adminMode ? editItem?.image : item.image)" [alt]="(adminMode ? editItem?.name : item.name)">
            </div>
            <div class="product-details">
              <h3 class="product-name">{{ adminMode ? editItem?.name : item.name }}</h3>
              @if (!adminMode && item?.description) {
                <p class="product-description">{{item.description}}</p>
              }
              @if (adminMode) {
                <div class="admin-edit-form">
                  <label>Nombre
                    <input type="text" [(ngModel)]="editItem.name">
                  </label>
                  <label>Precio (&euro;)
                    <input type="number" step="0.01" [(ngModel)]="editItem.price">
                  </label>
                  <label>Imagen (URL)
                    <input type="text" [(ngModel)]="editItem.image">
                  </label>
                  <label>Color name
                    <input type="text" [(ngModel)]="editItem.selectedColor.name" (ngModelChange)="onColorNameChange($event)">
                  </label>
                  <label>Color code
                    <input type="text" [(ngModel)]="editItem.selectedColor.code">
                  </label>
                  <label>Dimensions (width cm)
                    <input type="text" [(ngModel)]="editItem.dimensions.width">
                  </label>
                  <label>Dimensions (height cm)
                    <input type="text" [(ngModel)]="editItem.dimensions.height">
                  </label>
                  <label>Dimensions (depth cm)
                    <input type="text" [(ngModel)]="editItem.dimensions.depth">
                  </label>
                  @if (editItem?.isCustomFurniture) {
                    <label>Tipo
                      <input type="text" [(ngModel)]="editItem.type">
                    </label>
                    <label>Ancho (min cm)
                      <input type="number" [(ngModel)]="editItem.minWidth">
                    </label>
                    <label>Ancho (max cm)
                      <input type="number" [(ngModel)]="editItem.maxWidth">
                    </label>
                    <label>Alto (min cm)
                      <input type="number" [(ngModel)]="editItem.minHeight">
                    </label>
                    <label>Alto (max cm)
                      <input type="number" [(ngModel)]="editItem.maxHeight">
                    </label>
                    <label>Profundidad (cm)
                      <input type="number" [(ngModel)]="editItem.depth">
                    </label>
                    <label>Colores (Nombre:#HEX)
                      <input type="text" [(ngModel)]="editItem.colors">
                    </label>
                  }
                </div>
              }
              <div class="product-info">
                <div class="info-row">
                  <span class="label">Price:</span>
                  <span class="value price">&euro;{{ (adminMode ? editItem?.price : item.price)?.toFixed ? (adminMode ? editItem.price.toFixed(2) : item.price.toFixed(2)) : (adminMode ? editItem?.price : item?.price) }}</span>
                </div>
                @if ((adminMode ? editItem?.selectedColor : item?.selectedColor)) {
                  <div class="info-row">
                    <span class="label">Color:</span>
                    <span class="value color-info">
                      <span class="color-swatch" [style.backgroundColor]="(adminMode ? editItem?.selectedColor?.code : item?.selectedColor?.code)"></span>
                      {{ adminMode ? editItem?.selectedColor?.name : item?.selectedColor?.name }}
                    </span>
                  </div>
                }
                @if (item.quantity && item.quantity > 1) {
                  <div class="info-row">
                    <span class="label">Quantity:</span>
                    <span class="value">{{item.quantity}}</span>
                  </div>
                }
              </div>
            </div>
          </div>
          @if (!adminMode) {
            <div class="confirmation-message">
              <p>Do you want to add this item to your cart?</p>
            </div>
          }
          @if (adminMode) {
            <div class="confirmation-message">
              <p>Save changes to this product before continuing.</p>
            </div>
          }
        </div>
        <!-- Save confirmation (admin) -->
        @if (showSaveConfirm) {
          <div class="save-confirm-overlay">
            <div class="save-confirm-box" role="dialog" aria-modal="true" aria-label="Confirm save">
              <h3>Confirm Save</h3>
              <p>Are you sure you want to save the changes to this product?</p>
              <div class="save-confirm-actions">
                <button class="btn btn-cancel" (click)="cancelSave()">Cancel</button>
                <button class="btn btn-confirm" (click)="confirmSave()">Yes, Save</button>
              </div>
            </div>
          </div>
        }
        <div class="modal-footer">
          <button class="btn btn-cancel" (click)="onCancel()">
            Cancel
          </button>
          @if (!adminMode) {
            <button class="btn btn-confirm" (click)="onConfirm()">
              <i class="fas fa-shopping-cart"></i>
              Add to Cart
            </button>
          }
          @if (adminMode) {
            <button class="btn btn-confirm" (click)="onSave()">
              <i class="fas fa-save"></i>
              Save
            </button>
          }
        </div>
      </div>
    }
  </div>
}
