@if (isOpen) {
  <div class="modal-backdrop" (click)="$event.target === $event.currentTarget ? onCancel() : null">
    <div class="modal">
      <h3>{{ title }}</h3>
      <div class="modal-body">
        <div class="grid">
          @if (getImages().length) {
            <div class="gallery">
              <div class="main-image">
                <img [src]="getImages()[selectedImageIndex]" alt="Imagen" />
              </div>
              <div class="thumbs">
                @for (img of getImages(); track img; let i = $index) {
                  <img [src]="img" [class.active]="i === selectedImageIndex" (click)="selectedImageIndex = i" />
                }
              </div>
            </div>
          }
          <div class="details">
            <p><strong>Order ID:</strong> {{ getOrderId() }}</p>
            <p><strong>Status:</strong> {{ getStatus() }}</p>
            <p><strong>Date:</strong> {{ getDate() }}</p>
            <p><strong>Client:</strong> {{ getClientName() }}</p>
            @if (getContactInfo().email) {
              <p><strong>Email:</strong> {{ getContactInfo().email }}</p>
            }
            @if (getContactInfo().telefono) {
              <p><strong>Phone:</strong> {{ getContactInfo().telefono }}</p>
            }
            @if (getContactInfo().direccion) {
              <p><strong>Address:</strong> {{ getContactInfo().direccion }}</p>
            }
            <p><strong>Project / Title:</strong> {{ getTitle() }}</p>
            <p><strong>Final Price:</strong> @if (getBudget()) {
            <span>{{ getBudget() }}</span>
            }@if (!getBudget()) {
            <span>-</span>
          }</p>
          @if (getSpaceDimensions()) {
            <div class="space-dims">
              <h4>Space Dimensions</h4>
              @if (getSpaceDimensions().width) {
                <p>Width: {{ getSpaceDimensions().width }} cm</p>
              }
              @if (getSpaceDimensions().height) {
                <p>Height: {{ getSpaceDimensions().height }} cm</p>
              }
              @if (getSpaceDimensions().depth) {
                <p>Depth: {{ getSpaceDimensions().depth }} cm</p>
              }
            </div>
          }
          @if (getItems().length) {
            <div class="items-list">
              <h4>Furniture / Items</h4>
              <div class="items-table-wrapper">
                <table class="items-table">
                  <thead>
                    <tr>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Unit price</th>
                      <th>Quantity</th>
                      <th>Measures</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (it of getItems(); track it) {
                      <tr>
                        <td class="cell-img">
                          @if (it.image || it.img) {
                            <img [src]="it.image || it.img" class="thumb" alt="" />
                          }
                          @if (!it.image) {
                            @if (getItemExtraObject(it); as eo) {
                              @if (eo?.image) {
                                <div class="extra-image"><img [src]="eo.image" alt="" /></div>
                              }
                            }
                          }
                        </td>
                        <td class="cell-name">{{ it.name || it.nombre || it.title || it.producto || '-' }}</td>
                        <td class="cell-price">{{ getItemPrice(it) }}</td>
                        <td class="cell-qty">{{ it.quantity || getItemExtraField(it, 'quantity') || '-' }}</td>
                        <td class="cell-dims">{{ getItemDimensionsString(it) || '-' }}</td>
                        <td class="cell-notes">
                          @if (getItemExtraObject(it); as extraObj) {
                            <div>
                              @if (extraObj.name) {
                                <div><strong>{{ extraObj.name }}</strong></div>
                              }
                              @if (extraObj.color) {
                                <div>Color: {{ extraObj.color.name || extraObj.color }} @if (extraObj.color.code) {
                                  <span class="color-swatch" [style.background]="extraObj.color.code"></span>
                                }</div>
                              }
                              @if (extraObj.price) {
                                <div>Price: {{ extraObj.price }}</div>
                              }
                              @if (extraObj.notes) {
                                <div>Notes: {{ extraObj.notes }}</div>
                              }
                            </div>
                          }
                          @if (!getItemExtraObject(it) && getItemExtra(it); as extraText) {
                            <div>{{ extraText }}</div>
                          }
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
    <div class="actions">
      <button class="btn btn-ghost" (click)="onCancel()">Close</button>
    </div>
  </div>
</div>
}
